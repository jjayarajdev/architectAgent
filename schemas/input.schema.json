{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "EA Analysis Input",
  "type": "object",
  "required": ["repo", "requirement", "context", "documentation", "analysis_scope", "outputs"],
  "properties": {
    "repo": {
      "type": "object",
      "required": ["url", "branch"],
      "properties": {
        "url": {
          "type": "string",
          "pattern": "^https://github.com/[^/]+/[^/]+$",
          "description": "GitHub repository URL"
        },
        "branch": {
          "type": "string",
          "default": "main"
        },
        "path_filters": {
          "type": "array",
          "items": { "type": "string" },
          "default": ["src/**", "infra/**", "docs/**"]
        },
        "monorepo": {
          "type": "boolean",
          "default": false
        }
      }
    },
    "requirement": {
      "type": "object",
      "required": ["summary", "type"],
      "properties": {
        "summary": {
          "type": "string",
          "minLength": 10
        },
        "type": {
          "type": "string",
          "enum": ["feature", "bugfix", "refactor", "security", "performance"]
        },
        "drivers": {
          "type": "array",
          "items": { "type": "string" }
        },
        "acceptance_criteria": {
          "type": "array",
          "items": { "type": "string" }
        },
        "non_functional": {
          "type": "object",
          "properties": {
            "security": {
              "type": "array",
              "items": { "type": "string" }
            },
            "performance": {
              "type": "object",
              "properties": {
                "p95_ms": { "type": "number" },
                "concurrency": { "type": "number" }
              }
            },
            "availability_slo": {
              "type": "string",
              "pattern": "^\\d{1,2}(\\.\\d+)?%$"
            }
          }
        },
        "constraints": {
          "type": "array",
          "items": { "type": "string" }
        },
        "deadline": {
          "type": "string",
          "format": "date"
        }
      }
    },
    "context": {
      "type": "object",
      "properties": {
        "target_envs": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["dev", "staging", "prod", "test"]
          }
        },
        "architecture_style": {
          "type": "string",
          "enum": ["microservices", "modular monolith", "monolith", "serverless", "event-driven"]
        },
        "domain_owners": {
          "type": "array",
          "items": { "type": "string" }
        },
        "compliance": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["SOC2", "GDPR", "HIPAA", "PCI-DSS", "ISO27001"]
          }
        },
        "cloud": {
          "type": "string",
          "enum": ["AWS", "Azure", "GCP", "hybrid", "on-premise"]
        },
        "ci_cd": {
          "type": "string"
        },
        "risk_tolerance": {
          "type": "string",
          "enum": ["low", "medium", "high"]
        }
      }
    },
    "documentation": {
      "type": "object",
      "properties": {
        "roots": {
          "type": "array",
          "items": { "type": "string" },
          "default": ["docs/"]
        },
        "formats": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["md", "adr", "openapi", "plantuml", "mermaid"]
          }
        },
        "primary_diagram_style": {
          "type": "string",
          "enum": ["C4", "UML", "ArchiMate"],
          "default": "C4"
        }
      }
    },
    "analysis_scope": {
      "type": "object",
      "properties": {
        "code_depth": {
          "type": "string",
          "enum": ["shallow", "standard", "deep"],
          "default": "standard"
        },
        "history_window": {
          "type": "string",
          "pattern": "^\\d+d$",
          "default": "90d"
        },
        "include_open_prs": {
          "type": "boolean",
          "default": true
        },
        "include_issues_labels": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },
    "outputs": {
      "type": "object",
      "properties": {
        "deliverables": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "Requirement Summary",
              "Impacted Components",
              "Impact Analysis",
              "Updated Architecture (C4 L2/L3)",
              "ADRs",
              "Risks & Mitigations",
              "Effort & Plan",
              "Test Strategy",
              "Change Log draft"
            ]
          }
        },
        "format": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["md", "png", "pdf", "html"]
          },
          "default": ["md", "png"]
        },
        "repo_write_back": {
          "type": "object",
          "properties": {
            "pull_request": {
              "type": "boolean",
              "default": false
            },
            "pr_branch": {
              "type": "string",
              "default": "feat/ea-analysis-{{SLUG}}"
            }
          }
        }
      }
    }
  },
  "examples": [
    {
      "repo": {
        "url": "https://github.com/acme/platform",
        "branch": "main",
        "path_filters": ["src/**", "infra/**", "docs/**"],
        "monorepo": true
      },
      "requirement": {
        "summary": "Add multi-tenant support",
        "type": "feature",
        "drivers": ["B2B contracts", "Market expansion"],
        "acceptance_criteria": [
          "Tenant isolation at data + config layers",
          "RBAC for tenant admin",
          "Zero downtime migration"
        ],
        "non_functional": {
          "security": ["RLS", "PII isolation", "Encryption at rest"],
          "performance": {
            "p95_ms": 300,
            "concurrency": 2000
          },
          "availability_slo": "99.9%"
        },
        "constraints": ["Keep Postgres", "No breaking API v1", "Reuse existing auth"],
        "deadline": "2025-10-15"
      },
      "context": {
        "target_envs": ["dev", "staging", "prod"],
        "architecture_style": "modular monolith",
        "domain_owners": ["platform", "auth", "billing"],
        "compliance": ["SOC2", "GDPR"],
        "cloud": "Azure",
        "ci_cd": "GitHub Actions",
        "risk_tolerance": "medium"
      },
      "documentation": {
        "roots": ["docs/", "/wiki/export", "/adr"],
        "formats": ["md", "adr", "openapi", "plantuml", "mermaid"],
        "primary_diagram_style": "C4"
      },
      "analysis_scope": {
        "code_depth": "standard",
        "history_window": "90d",
        "include_open_prs": true,
        "include_issues_labels": ["architecture", "breaking-change"]
      },
      "outputs": {
        "deliverables": [
          "Requirement Summary",
          "Impacted Components",
          "Impact Analysis",
          "Updated Architecture (C4 L2/L3)",
          "ADRs",
          "Risks & Mitigations",
          "Effort & Plan",
          "Test Strategy",
          "Change Log draft"
        ],
        "format": ["md", "png"],
        "repo_write_back": {
          "pull_request": true,
          "pr_branch": "feat/ea-analysis-multi-tenancy"
        }
      }
    }
  ]
}